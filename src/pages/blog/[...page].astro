---
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import FormattedDate from "../../components/FormattedDate.astro";
import Pagination from "../../components/Pagination.astro";

export async function getStaticPaths({ paginate }: any) {
  const allBlogEntries = (await getCollection("blog")).sort(
    (a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
  );

  return paginate(allBlogEntries, { pageSize: 6 });
}

interface Props {
  page: any;
}

const { page } = Astro.props;
const title = "Blog";
const description = "All blog posts from Badgers Perfection";
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
    <style>
      main {
        width: calc(100% - 2em);
        max-width: 100%;
        margin: 0;
      }
      .blog-posts {
        width: 720px;
        max-width: calc(100% - 2em);
        margin: auto;
        padding: 2em 1em;
      }
      .blog-post {
        margin-bottom: 3em;
        padding-bottom: 2em;
        border-bottom: 3px solid var(--cga-light-blue);
      }
      .blog-post:last-child {
        border-bottom: none;
      }
      .blog-post h2 {
        margin: 0 0 0.5em 0;
      }
      .blog-post a {
        text-decoration: none;
        color: var(--cga-light-blue);
      }
      .blog-post a:hover {
        color: var(--cga-light-cyan);
        text-decoration: underline;
      }
      .post-meta {
        display: flex;
        gap: 1em;
        margin-bottom: 1em;
        color: var(--cga-light-gray);
        font-size: 0.9em;
      }
      .pagination-wrapper {
        display: flex;
        justify-content: center;
        gap: 0.5em;
        margin-top: 3em;
        padding-top: 2em;
        border-top: 3px solid var(--cga-light-blue);
      }
    </style>
  </head>

  <body>
    <Header />
    <main>
      <section class="blog-posts">
        <h1>ðŸ“š Blog Posts</h1>
        
        {page.data.map((post: any) => (
          <article class="blog-post">
            <h2>
              <a href={`/blog/${post.slug}/`}>{post.data.title}</a>
            </h2>
            <div class="post-meta">
              <FormattedDate date={post.data.pubDate} />
              {post.data.tags && (
                <span>{post.data.tags.join(", ")}</span>
              )}
            </div>
            <p>{post.data.description}</p>
            <a href={`/blog/${post.slug}/`}>Read more â†’</a>
          </article>
        ))}

        <div class="pagination-wrapper">
          <Pagination
            page={page}
            urlPattern="/blog/page/:page"
            firstPageUrl="/blog"
            showFirstLast={true}
            showPrevNext={true}
          />
        </div>
      </section>
    </main>
    <Footer />
  </body>
</html>