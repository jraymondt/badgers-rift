---
import { getCollection } from 'astro:content';
import BlogPost from '../../../layouts/BlogPost.astro';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  
  return await Promise.all(
    blogEntries.map(async (entry) => {
      const year = new Date(entry.data.pubDate).getFullYear();
      const cleanSlug = entry.id.replace(/^\d{4}\//, '');
      const { Content } = await entry.render();
      
      return {
        params: { 
          year: year.toString(),
          slug: cleanSlug
        },
        props: { 
          title: entry.data.title,
          description: entry.data.description,
          pubDate: entry.data.pubDate,
          updatedDate: entry.data.updatedDate,
          heroImage: entry.data.heroImage,
          Content
        },
      };
    })
  );
}

type Props = {
  title: string;
  description: string;
  pubDate: Date;
  updatedDate?: Date;
  heroImage?: string;
  Content: any;
};

const { title, description, pubDate, updatedDate, heroImage, Content } = Astro.props;
const { slug } = Astro.params;
---

<BlogPost
  title={title}
  description={description}
  pubDate={pubDate}
  updatedDate={updatedDate}
  heroImage={heroImage}
  slug={slug}
>
  <Content />
</BlogPost>