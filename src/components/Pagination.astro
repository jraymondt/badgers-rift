---
// Lightly typed props coming from Astro pages.
import type { Page } from "astro";
import Previous from "./pagination/Previous.astro";
import Next from "./pagination/Next.astro";
import Link from "./pagination/Link.astro";
import Current from "./pagination/Current.astro";
import Ellipsis from "./pagination/Ellipsis.astro";
import { getPageNumbers } from "../utils/pagination";

interface Props {
  page: Page<any>;
  urlPattern: string;
  firstPageUrl?: string;
  windowSize?: number;
  showPrevNext?: boolean;
  showFirstLast?: boolean;
  previousLabel?: string;
  nextLabel?: string;
}

// Pull out the knobs with friendly defaults so the component is drop-in.
const {
  page,
  urlPattern,
  firstPageUrl,
  windowSize = 5,
  showFirstLast = true,
  showPrevNext = true,
  previousLabel = "← Previous",
  nextLabel = "Next →",
} = Astro.props;

// Build the sliding window of page numbers.
const pageNumbers = getPageNumbers(page, windowSize);
const firstPageInRange = pageNumbers[0];
const lastPageInRange = pageNumbers[pageNumbers.length - 1];

// Decide when to show first/last links (only if they’re outside the window).
const showFirst = showFirstLast && pageNumbers[0] !== 1;
const showLast = showFirstLast && lastPageInRange !== page.lastPage;

// Special-case page 1 so / is used instead of /page/1 if provided.
const previousUrl =
  firstPageUrl && page.currentPage === 2 ? firstPageUrl : page.url.prev;
---

<nav role="navigation" aria-label="Pagination">
  <ul class="pagination-list">
    {/* Optional previous button */}
    {showPrevNext && <Previous url={previousUrl} label={previousLabel} />}
    
    {/* Jump to first page when it’s outside the current window */}
    {showFirst && (
      <li>
        <Link
          pageNumber={1}
          urlPattern={urlPattern}
          firstPageUrl={firstPageUrl}
        />
      </li>
    )}
    
    {/* Leading ellipsis when there’s a gap before the window */}
    {firstPageInRange > 2 && (
      <li>
        <Ellipsis />
      </li>
    )}
    
    {/* Main window of numbered links, highlighting the current page */}
    {pageNumbers.map((pageNumber) => (
      <li>
        {pageNumber === page.currentPage ? (
          <Current pageNumber={pageNumber} />
        ) : (
          <Link
            pageNumber={pageNumber}
            urlPattern={urlPattern}
            firstPageUrl={firstPageUrl}
          />
        )}
      </li>
    ))}
    
    {/* Trailing ellipsis when there’s a gap after the window */}
    {lastPageInRange < page.lastPage - 1 && (
      <li>
        <Ellipsis />
      </li>
    )}
    
    {/* Jump to last page when it’s outside the current window */}
    {showLast && (
      <li>
        <Link
          pageNumber={page.lastPage}
          urlPattern={urlPattern}
          firstPageUrl={firstPageUrl}
        />
      </li>
    )}
    
    {/* Optional next button */}
    {showPrevNext && <Next url={page.url.next} label={nextLabel} />}
  </ul>
</nav>

<style>
  nav {
    display: flex;
    justify-content: center;
    margin: 2em 0;
  }
  
  .pagination-list {
    display: flex;
    list-style: none;
    gap: 0.5em;
    padding: 0;
    margin: 0;
    flex-wrap: wrap;
    justify-content: center;
  }
  
  li {
    display: flex;
  }
</style>